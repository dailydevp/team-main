<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.zerock.mapper.EatBoardMapper">

	<select id="getList" resultType="org.zerock.domain.EatBoardVO">
    
    <![CDATA[
    
	SELECT
		eatbno eatbno,
		title title,
		content content,
		adress adress,
		writer writer,
		regdate regdate,
		updatedate updatedate
	FROM eatBoard
	where eatbno > 0 order by eatbno DESC
     
    ]]>

	</select>

	<sql id="criteria">
		<where>
			<foreach item="type" separator="OR" collection="typeArr">
				<choose>
					<when test='type == "T"'>
						b.title LIKE CONCAT('%', #{keyword}, '%')
					</when>
					<when test='type == "W"'>
						b.writer LIKE CONCAT('%', #{keyword}, '%')
					</when>
					<when test='type == "C"'>
						b.content LIKE CONCAT('%', #{keyword}, '%')
					</when>
				</choose>
			</foreach>
		</where>
	</sql>
	

	<select id="getTotalCount" resultType="int">
		SELECT COUNT(*) FROM eatBoard
		<include refid="criteria"></include>
	</select>

<select id="getListWithPaging" resultType="org.zerock.domain.EatBoardVO">
    SELECT 
    	eatbno,
    	title,
    	content,
    	adress,
    	writer,
    	regdate,
    	updatedate
     FROM eatBoard 
     
  <include refid="criteria"></include>
	 GROUP BY eatbno
     ORDER BY eatbno DESC
     LIMIT #{from}, #{amount}
   
     
  </select>
	
	<insert id="insert">
		INSERT INTO eatBoard (title, content, adress, writer)
		VALUES (#{title}, #{content}, #{adress}, #{writer})
	</insert>

	<insert id="insertSelectKey" useGeneratedKeys="true"
		keyProperty="eatbno" keyColumn="eatbno">
		INSERT INTO eatBoard (title, content, adress, writer)
		VALUES (#{title}, #{content}, #{adress}, #{writer})
	</insert>

	<select id="read" resultType="org.zerock.domain.EatBoardVO">
		SELECT * FROM eatBoard WHERE eatbno = #{eatbno}
	</select>

	<delete id="delete">
		DELETE FROM eatBoard WHERE eatbno = #{eatbno}
	</delete>

	<update id="update">
		UPDATE eatBoard
		SET
		title = #{title},
		content = #{content},
		adress = #{adress},
		writer = #{writer},
		updateDate = NOW()

		WHERE
		eatbno = #{eatbno}

	</update>
</mapper>

















