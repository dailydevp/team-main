<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <mapper namespace="org.zerock.mapper.MemberMapper">
  
  <insert id="insert">
  	INSERT INTO tbl_member2
  	(userid, userpw, nickName,address, email,phoneNum)
  	VALUES
  	(#{userid},#{userpw},#{nickName},#{address},#{email},#{phoneNum})
  </insert>
  
  <insert id="insertAuth">
  	INSERT INTO tbl_member_auth2
  	(userid, auth)
  	VALUES
  	(#{userid},#{auth})
  </insert>
  
  
  <select id="read" resultMap="memberM">
  	SELECT
			m.userid userid,
			m.userpw userpw,
			m.nickName nickName,
			m.email email,
			m.address address,
			m.phoneNum phoneNumm,
			a.auth auth
		FROM
			tbl_member2 m LEFT JOIN tbl_member_auth2 a ON m.userid = a.userid
		WHERE 
			m.userid = #{userid}

  </select>
  
  <update id="update">
  UPDATE tbl_member2
  SET userpw = #{userpw},
  	  nickName = #{nickName},
  	  phoneNum = #{phoneNum}
  WHERE
  	userid = #{userid}
  </update>
  
  <delete id="delete">
  DELETE FROM tbl_member2
  WHERE userid=#{userid}
  </delete>
  
  <delete id="deleteAuth">
  DELETE FROM tbl_member_auth2
  WHERE user id = #{userid}
  </delete>

  
  <select id="check" resultMap="memberM">
    	SELECT
			m.userid userid,
			m.email email,
			m.userpw userpw,
			m.nickName nickName,
			m.address address,
			m.phoneNum phoneNum
		FROM
			tbl_member2 m LEFT JOIN tbl_member_auth2 a ON m.userid = a.userid
		WHERE 
			m.email = #{email}
  </select>
  
  <!-- 비밀번호 변경 -->
	<update id="updatePw" >
		update member 
		set pw = #{pw} 
		where 
		userid = #{userid}
	</update>
  

  
  <resultMap type="org.zerock.domain.MemberVO" id= "memberM">
  	<id property="userid" column="userid" />
  	<result property="userpw" column="userpw"/>
  	<result property="nickName" column="nickName"/>
  	<result property="email" column="email"/>
  	<result property="address" column="address"/>
  	<result property="phoneNum" column="phoneNum" />
  	<result property="enabled" column="enabled"/>
  	<collection property="authList" resultMap="authM"/>
  </resultMap>
  <resultMap type="org.zerock.domain.AuthVO" id="authM">
  	<result property="userid" column="userid"/>
  	<result property="auth" column="auth" />
  </resultMap>
  
  </mapper>